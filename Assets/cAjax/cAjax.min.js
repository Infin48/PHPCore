!function(a){var e=a('[ajax-selector="window"]'),t=a('[ajax-selector="loading"]'),o=a('[ajax-selector="window-alert"]');jQuery.cAjax=function(s,d){a("body").on("click",'[ajax="'+s+'"]',function(s){s.preventDefault(),s.stopImmediatePropagation(),t.show();var i="",n=i=a(this);i.data("id")||a.each(["block block-form","block","field","list-row","panel"],function(a,e){if(n.closest('[ajax-selector="'+e+'"]').length)return i=n.closest('[ajax-selector="'+e+'"]').first(),!1});var c=a(this).attr("ajax-process")?a(this).attr("ajax-process"):a(this).attr("ajax");d.id=i.attr("ajax-process-id"),d.type=i.attr("ajax-process-type"),d.process=i.attr("ajax-process-type")?i.attr("ajax-process-type")+c:c,d.ajax&&("post"==d.ajax.method?(delete d.ajax.context.id,delete d.ajax.context.method,delete d.ajax.context.process):(d.ajax.context.id=d.id,d.ajax.context.method=d.ajax.method,d.process&&(d.ajax.context.process=d.process))),d.onload&&(d.process in d.onload?d.onload[d.process].call(n,d,i):"default"in d.onload&&d.onload.default.call(n,d,i)),methods={ajax:{get:function(){a.get(d.ajax.url,d.ajax.context,function(a){methods.finish(a)})},post:function(){a.post(d.ajax.url+"?id="+d.id+(d.process?"&process="+d.process:"")+"&method=post",d.ajax.context,function(a){methods.finish(a)})}},finish:function(s){t.hide();try{d.data=a.parseJSON(s)}catch(a){return s&&(o.removeClass("window-hide").addClass("window-active").removeClass("window-alert-success"),o.find('[ajax-selector="window-alert-body"]').text(s),setTimeout(function(){o.addClass("window-hide").removeClass("window-active")},1500)),!1}return"ok"!=d.data.status?("error"==d.data.status&&(o.removeClass("window-hide").addClass("window-active").removeClass("window-alert-success"),o.find('[ajax-selector="window-alert-body"]').text(d.data.error),setTimeout(function(){o.addClass("window-hide").removeClass("window-active")},1500)),!1):d.data.redirect?(window.location.href=d.data.redirect,!0):d.data.refresh?(location.reload(),!0):(d.data.message&&(o.removeClass("window-hide").addClass("window-active").addClass("window-alert-success"),o.find('[ajax-selector="window-alert-body"]').text(d.data.message),setTimeout(function(){o.addClass("window-hide").removeClass("window-active")},1500)),1==d.refresh&&location.reload(),d.success&&(d.process in d.success?d.success[d.process].call(n,d,i):"default"in d.success&&d.success.default.call(n,d,i)),void e.removeClass("window-active"))}},d.window&&(d.window.context.id=d.id,d.window.context.process=d.process,a.get(d.window.url,d.window.context,function(s){t.hide();try{d.data=a.parseJSON(s)}catch(a){return s&&(o.removeClass("window-hide").addClass("window-active").removeClass("window-alert-success"),o.find('[ajax-selector="window-alert-body"]').text(s),setTimeout(function(){o.addClass("window-hide").removeClass("window-active")},1500)),!1}if("ok"!=d.data.status)return!1;e.addClass("window-active"),e.find('[ajax-selector="window-title"]').text(d.data.windowTitle),e.find('[ajax-selector="window-body"]').html(d.data.windowContent),d.data.windowSubmit?(e.find('[ajax-selector="window-bottom"]').show(),e.find('[ajax-selector="window-submit"]').text(d.data.windowSubmit),e.find('[ajax-selector="window-cancel"]').text(d.data.windowClose)):e.find('[ajax-selector="window-bottom"]').hide(),d.window.onload&&d.window.onload.call(e,d)})),d.ajax&&(d.window?(a('[ajax="confirm"]').on("click",function(a){a.preventDefault(),t.show(),d.window.submit&&d.window.submit.call(e,d),"post"==d.ajax.method?methods.ajax.post():methods.ajax.get()}),a("body").on("click",function(t){a(t.target).parents('[ajax-selector="window"]').length||(a('[ajax="confirm"]').off("click"),e.removeClass("window-active")),"window-close"==a(t.target).attr("ajax")&&(a('[ajax="confirm"]').off("click"),e.removeClass("window-active"))})):"post"==d.ajax.method?methods.ajax.post():methods.ajax.get())})}}(jQuery);