/**
 * This file is part of the PHPCore forum software
 * 
 * Made by InfinCZ 
 * @link https://github.com/Infin48
 *
 * @copyright (c) PHPCore Limited https://phpcore.cz
 * @license GNU General Public License, version 3 (GPL-3.0)
 */
!function(a){var t=a('[ajax-selector="window"]'),e=a('[ajax-selector="loading"]'),o=a('[ajax-selector="window-alert"]');jQuery.cAjax=function(d,s){a("body").on("click",'[ajax="'+d+'"]',function(i){i.preventDefault(),i.stopImmediatePropagation(),e.show();var n="",w=n=a(this);n.data("id")||a.each(["block","field","list-row"],function(a,t){if(w.closest('[ajax-selector="'+t+'"]').length)return n=w.closest('[ajax-selector="'+t+'"]').first(),!1}),s.id=n.attr("data-id"),s.type=n.attr("data-type"),s.process=n.attr("data-type")?s.type+"/"+d.substr(0,1).toUpperCase()+d.substr(1):null,s.ajax&&("post"==s.ajax.method?(delete s.ajax.context.id,delete s.ajax.context.method,delete s.ajax.context.process):(s.ajax.context.id=s.id,s.ajax.context.method=s.ajax.method,s.process&&(s.ajax.context.process=s.process))),s.onload&&s.onload.call(w,s,n),methods={ajax:{get:function(){a.get(s.ajax.url,s.ajax.context,function(a){methods.finish(a)})},post:function(){a.post(s.ajax.url+"?id="+s.id+(s.process?"&process="+s.process:"")+"&method=post",s.ajax.context,function(a){methods.finish(a)})}},finish:function(d){e.hide();try{s.data=a.parseJSON(d)}catch(a){return d&&(o.removeClass("window-hide").addClass("window-active").removeClass("window-alert-success"),o.find('[ajax-selector="window-alert-body"]').text(d),setTimeout(function(){o.addClass("window-hide").removeClass("window-active")},1500)),!1}return"ok"!=s.data.status?("error"==s.data.status&&(o.removeClass("window-hide").addClass("window-active").removeClass("window-alert-success"),o.find('[ajax-selector="window-alert-body"]').text(s.data.error),setTimeout(function(){o.addClass("window-hide").removeClass("window-active")},1500)),!1):s.data.redirect?(window.location.href=s.data.redirect,!0):(s.data.message&&(o.removeClass("window-hide").addClass("window-active").addClass("window-alert-success"),o.find('[ajax-selector="window-alert-body"]').text(s.data.message),setTimeout(function(){o.addClass("window-hide").removeClass("window-active")},1500)),1==s.refresh&&location.reload(),s.success.call(w,s,n),void t.removeClass("window-active"))}},s.window&&(s.window.context.id=s.id,s.window.context.process=s.process,a.get(s.window.url,s.window.context,function(d){e.hide();try{s.data=a.parseJSON(d)}catch(a){return d&&(o.removeClass("window-hide").addClass("window-active").removeClass("window-alert-success"),o.find('[ajax-selector="window-alert-body"]').text(d),setTimeout(function(){o.addClass("window-hide").removeClass("window-active")},1500)),!1}if("ok"!=s.data.status)return!1;t.addClass("window-active"),t.find('[ajax-selector="window-title"]').text(s.data.windowTitle),console.log(s.data.windowContent),t.find('[ajax-selector="window-body"]').html(s.data.windowContent),s.data.windowSubmit?(t.find('[ajax-selector="window-bottom"]').show(),t.find('[ajax-selector="window-submit"]').text(s.data.windowSubmit),t.find('[ajax-selector="window-cancel"]').text(s.data.windowClose)):t.find('[ajax-selector="window-bottom"]').hide(),s.window.onload&&s.window.onload.call(t,s)})),s.ajax&&(s.window?(a('[ajax="confirm"]').on("click",function(a){a.preventDefault(),e.show(),s.window.submit&&s.window.submit.call(t,s),"post"==s.ajax.method?methods.ajax.post():methods.ajax.get()}),a("body").on("click",function(e){a(e.target).parents('[ajax-selector="window"]').length||(a('[ajax="confirm"]').off("click"),t.removeClass("window-active")),"window-close"==a(e.target).attr("ajax")&&(a('[ajax="confirm"]').off("click"),t.removeClass("window-active"))})):"post"==s.ajax.method?methods.ajax.post():methods.ajax.get())})}}(jQuery);