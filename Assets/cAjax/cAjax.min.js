/**
 * This file is part of the PHPCore forum software
 * 
 * Made by InfinCZ 
 * @link https://github.com/Infin48
 *
 * @copyright (c) PHPCore Limited https://phpcore.cz
 * @license GNU General Public License, version 3 (GPL-3.0)
*/ !function(a){var o=!0,i=a('[js="window"]'),s=a('[js="opacity"]'),n=a('[js="loading"]'),e=a('[js="window-alert"]'),d={},c={show:function(){i.addClass("window-show").removeClass("window-hide"),s.addClass("opacity-show").removeClass("opacity-hide")},hide:function(){i.hasClass("window-show")&&i.addClass("window-hide").removeClass("window-show"),s.hasClass("opacity-show")&&s.addClass("opacity-hide").removeClass("opacity-show")}};function r(a,i){return e.length&&a&&i?(t="error","error"==i&&(t="success"),e.addClass("window-show").removeClass("window-hide"),e.find('[js^="window-alert-icon"]').hide(),e.find('[js="window-alert-icon-'+i+'"]').show(),e.removeClass("window-alert-"+t).addClass("window-alert-"+i),e.find('[js="window-alert-body"]').text(a),setTimeout(function(){e.addClass("window-hide").removeClass("window-show"),setTimeout(function(){o=!0},250)},1750)):o=!0,n.removeClass("loading-show"),!1}function l(){d=self.settings,(explode=self.settings.context.ajax.split("/"))[0]="run",d.context.ajax=explode.join("/"),self.settings=d,d.submit&&a.each(d.submit,function(a,o){return a===d.context.ajax?(d.submit[a].call($button,d,$element),!1):((explode=d.context.ajax.split("/"))[1]="?",3!=explode.length)?void 0:a===explode.join("/")?(d.submit[a].call($button,d,$element),!1):void 0}),a.post(window.location.origin+window.location.pathname+"action-ajax/",self.settings.context,function(o){if(n.addClass("loading-show"),!o)return r();try{d.data=a.parseJSON(o)}catch(i){return r(o,"error")}return(d.data.data||(d.data.data={}),"ok"!=d.data.status)?(d.failure&&d.failure.call($button,d,$element),r(d.data.message,"error")):d.data.redirect?(window.location.href=d.data.redirect,!0):d.data.refresh?(location.reload(),!0):(d.success&&a.each(d.success,function(a,o){return a===d.context.ajax?(d.success[a].call($button,d,$element),!1):((explode=d.context.ajax.split("/"))[1]="?",3!=explode.length)?void 0:a===explode.join("/")?(d.success[a].call($button,d,$element),!1):void 0}),c.hide(),r(d.data.message?d.data.message:"","success"))})}jQuery.cAjax=function(s){a(document).on("click","[ajax-action]",function(e){if(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1!=o){o=!1,n.addClass("loading-show");var d=$element=a(this);$element.attr("js-id")||a.each(["block block-form","block","form","list-row","panel"],function(a,o){if(d.closest('[js="'+o+'"]').length)return $element=d.closest('[js="'+o+'"]').first(),!1}),s.context={},s.context.ajax="window/",void 0===a(this).attr("ajax-window")&&(s.context.ajax="run/"),s.context.id=$element.attr("ajax-id")?$element.attr("ajax-id"):a(this).attr("ajax-id"),s.context.ajax+=$element.attr("ajax-item")?$element.attr("ajax-item")+"/"+a(this).attr("ajax-action"):a(this).attr("ajax-action"),s.context.selected=0,$element.is("[ajax-selected]")&&(s.context.selected=1),self.settings=s,self.$button=a(this),s.context.ajax.startsWith("window")?(a.post(window.location.origin+window.location.pathname+"action-ajax/",s.context,function(e){if(!e)return r();try{self.settings.data=a.parseJSON(e)}catch(d){return r(e,"error")}if("ok"!=s.data.status)return r(s.data.message,"error");c.show(),i.find('[js="window-title"]').text(s.data.data.title),i.find('[js="window-body"]').html(s.data.data.content),s.data.data.submit?(i.find('[js="window-bottom"]').show(),i.find('[js="window-submit"]').text(s.data.data.submit),i.find('[js="window-cancel"]').text(s.data.data.close)):i.find('[js="window-bottom"]').hide(),o=!0,n.removeClass("loading-show")}),a(document).on("click",'[ajax="confirm"]',function(a){a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation(),!1!=o&&(o=!1,n.addClass("loading-show"),l())}),a(document).on("click",function(o){a(o.target).parents('[js="window"]').length||(a('[ajax="confirm"]').off("click"),c.hide()),"window-close"==a(o.target).attr("ajax")&&(a('[ajax="confirm"]').off("click"),c.hide())})):(s.submit&&a.each(s.submit,function(a,o){return a===s.context.ajax?(s.submit[a].call(d,s,$element),!1):((explode=s.context.ajax.split("/"))[1]="?",3!=explode.length)?void 0:a===explode.join("/")?(s.submit[a].call(d,s,$element),!1):void 0}),l())}})}}(jQuery);